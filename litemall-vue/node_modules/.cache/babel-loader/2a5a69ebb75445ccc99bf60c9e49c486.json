{"remainingRequest":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\src\\views\\order\\payment\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\src\\views\\order\\payment\\index.vue","mtime":1703663878000},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\babel.config.js","mtime":1703663878000},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1737137198017},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1737137193353},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1737137198017},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1737137194839}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"C:/Users/Wang/Desktop/polyhedron/litemall-master/litemall-master/litemall-vue/node_modules/@babel/runtime/helpers/interopRequireDefault.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _defineProperty2 = _interopRequireDefault(require(\"C:/Users/Wang/Desktop/polyhedron/litemall-master/litemall-master/litemall-vue/node_modules/@babel/runtime/helpers/defineProperty.js\"));\nrequire(\"vant/es/radio-group/style\");\nvar _radioGroup = _interopRequireDefault(require(\"vant/es/radio-group\"));\nrequire(\"core-js/modules/es6.function.name\");\nrequire(\"vant/es/radio/style\");\nvar _radio = _interopRequireDefault(require(\"vant/es/radio\"));\nrequire(\"core-js/modules/es6.regexp.replace\");\nrequire(\"vant/es/dialog/style\");\nvar _dialog = _interopRequireDefault(require(\"vant/es/dialog\"));\nvar _has2 = _interopRequireDefault(require(\"lodash/has\"));\nvar _api = require(\"@/api/api\");\nvar _localStorage = require(\"@/utils/local-storage\");\nvar _default = exports.default = {\n  name: 'payment',\n  data: function data() {\n    return {\n      payWay: 'wx',\n      order: {\n        orderInfo: {},\n        orderGoods: []\n      },\n      orderId: 0\n    };\n  },\n  created: function created() {\n    if ((0, _has2.default)(this.$route.params, 'orderId')) {\n      this.orderId = this.$route.params.orderId;\n      this.getOrder(this.orderId);\n    }\n  },\n  methods: {\n    getOrder: function getOrder(orderId) {\n      var _this = this;\n      (0, _api.orderDetail)({\n        orderId: orderId\n      }).then(function (res) {\n        _this.order = res.data.data;\n      });\n    },\n    pay: function pay() {\n      var _this2 = this;\n      _dialog.default.alert({\n        message: '你选择了' + (this.payWay === 'wx' ? '微信支付' : '支付宝支付')\n      }).then(function () {\n        if (_this2.payWay === 'wx') {\n          var ua = navigator.userAgent.toLowerCase();\n          var isWeixin = ua.indexOf('micromessenger') != -1;\n          if (isWeixin) {\n            (0, _api.orderPrepay)({\n              orderId: _this2.orderId\n            }).then(function (res) {\n              var data = res.data.data;\n              var prepay_data = JSON.stringify({\n                appId: data.appId,\n                timeStamp: data.timeStamp,\n                nonceStr: data.nonceStr,\n                package: data.packageValue,\n                signType: 'MD5',\n                paySign: data.paySign\n              });\n              (0, _localStorage.setLocalStorage)({\n                prepay_data: prepay_data\n              });\n              if (typeof WeixinJSBridge == 'undefined') {\n                if (document.addEventListener) {\n                  document.addEventListener('WeixinJSBridgeReady', _this2.onBridgeReady, false);\n                } else if (document.attachEvent) {\n                  document.attachEvent('WeixinJSBridgeReady', _this2.onBridgeReady);\n                  document.attachEvent('onWeixinJSBridgeReady', _this2.onBridgeReady);\n                }\n              } else {\n                _this2.onBridgeReady();\n              }\n            }).catch(function (err) {\n              _dialog.default.alert({\n                message: err.data.errmsg\n              });\n              that.$router.replace({\n                name: 'paymentStatus',\n                params: {\n                  status: 'failed'\n                }\n              });\n            });\n          } else {\n            (0, _api.orderH5pay)({\n              orderId: _this2.orderId\n            }).then(function (res) {\n              var data = res.data.data;\n              window.location.replace(data.mwebUrl + '&redirect_url=' + encodeURIComponent(window.location.origin + '/#/?orderId=' + _this2.orderId + '&tip=yes'));\n            }).catch(function (err) {\n              _dialog.default.alert({\n                message: err.data.errmsg\n              });\n            });\n          }\n        } else {\n          //todo : alipay\n        }\n      });\n    },\n    onBridgeReady: function onBridgeReady() {\n      var that = this;\n      var data = (0, _localStorage.getLocalStorage)('prepay_data');\n      // eslint-disable-next-line no-undef\n      WeixinJSBridge.invoke('getBrandWCPayRequest', JSON.parse(data.prepay_data), function (res) {\n        if (res.err_msg == 'get_brand_wcpay_request:ok') {\n          that.$router.replace({\n            name: 'paymentStatus',\n            params: {\n              status: 'success'\n            }\n          });\n        } else if (res.err_msg == 'get_brand_wcpay_request:cancel') {\n          that.$router.replace({\n            name: 'paymentStatus',\n            params: {\n              status: 'cancel'\n            }\n          });\n        } else {\n          that.$router.replace({\n            name: 'paymentStatus',\n            params: {\n              status: 'failed'\n            }\n          });\n        }\n      });\n    }\n  },\n  components: (0, _defineProperty2.default)((0, _defineProperty2.default)((0, _defineProperty2.default)({}, _radio.default.name, _radio.default), _radioGroup.default.name, _radioGroup.default), _dialog.default.name, _dialog.default)\n};",{"version":3,"names":["_api","require","_localStorage","_default","exports","default","name","data","payWay","order","orderInfo","orderGoods","orderId","created","_has2","$route","params","getOrder","methods","_this","orderDetail","then","res","pay","_this2","_dialog","alert","message","ua","navigator","userAgent","toLowerCase","isWeixin","indexOf","orderPrepay","prepay_data","JSON","stringify","appId","timeStamp","nonceStr","package","packageValue","signType","paySign","setLocalStorage","WeixinJSBridge","document","addEventListener","onBridgeReady","attachEvent","catch","err","errmsg","that","$router","replace","status","orderH5pay","window","location","mwebUrl","encodeURIComponent","origin","getLocalStorage","invoke","parse","err_msg","components","_defineProperty2","_radio","_radioGroup"],"sources":["src/views/order/payment/index.vue"],"sourcesContent":["<template>\n  <div class=\"payment\">\n    <div class=\"time_down payment_group\">\n      请在\n      <span class=\"red\">半小时内</span>\n      完成付款，否则系统自动取消订单\n    </div>\n\n    <van-cell-group class=\"payment_group\">\n      <van-cell title=\"订单编号\" :value=\"order.orderInfo.orderSn\"/>\n      <van-cell title=\"实付金额\">\n        <span class=\"red\">{{order.orderInfo.actualPrice *100 | yuan}}</span>\n      </van-cell>\n    </van-cell-group>\n\n    <div class=\"pay_way_group\">\n      <div class=\"pay_way_title\">选择支付方式</div>\n      <van-radio-group v-model=\"payWay\">\n        <van-cell-group>\n          <van-cell>\n            <template slot=\"title\">\n              <img src=\"../../../assets/images/ali_pay.png\" alt=\"支付宝\" width=\"82\" height=\"29\">\n            </template>\n            <van-radio name=\"ali\"/>\n          </van-cell>\n          <van-cell>\n            <template slot=\"title\">\n              <img src=\"../../../assets/images/wx_pay.png\" alt=\"微信支付\" width=\"113\" height=\"23\">\n            </template>            \n            <van-radio name=\"wx\"/>\n          </van-cell>\n        </van-cell-group>\n      </van-radio-group>\n    </div>\n\n    <van-button class=\"pay_submit\" @click=\"pay\" type=\"primary\" bottomAction>去支付</van-button>\n  </div>\n</template>\n\n<script>\nimport { Radio, RadioGroup, Dialog } from 'vant';\nimport { orderDetail, orderPrepay, orderH5pay } from '@/api/api';\nimport _ from 'lodash';\nimport { getLocalStorage, setLocalStorage } from '@/utils/local-storage';\n\nexport default {\n  name: 'payment',\n\n  data() {\n    return {\n      payWay: 'wx',\n      order: {\n        orderInfo: {},\n        orderGoods: []\n      },\n      orderId: 0\n    };\n  },\n  created() {\n    if (_.has(this.$route.params, 'orderId')) {\n      this.orderId = this.$route.params.orderId;\n      this.getOrder(this.orderId);\n    }\n  },\n  methods: {\n    getOrder(orderId) {\n      orderDetail({orderId: orderId}).then(res => {\n        this.order = res.data.data;\n      });\n    },\n    pay() {\n      \n      Dialog.alert({\n        message: '你选择了' + (this.payWay === 'wx' ? '微信支付' : '支付宝支付')\n      }).then(() => {\n        if (this.payWay === 'wx') {\n          let ua = navigator.userAgent.toLowerCase();\n          let isWeixin = ua.indexOf('micromessenger') != -1;\n          if (isWeixin) {\n            orderPrepay({ orderId: this.orderId })\n              .then(res => {\n                let data = res.data.data;\n                let prepay_data = JSON.stringify({\n                  appId: data.appId,\n                  timeStamp: data.timeStamp,\n                  nonceStr: data.nonceStr,\n                  package: data.packageValue,\n                  signType: 'MD5',\n                  paySign: data.paySign\n                });\n                setLocalStorage({ prepay_data: prepay_data });\n\n                if (typeof WeixinJSBridge == 'undefined') {\n                  if (document.addEventListener) {\n                    document.addEventListener(\n                      'WeixinJSBridgeReady',\n                      this.onBridgeReady,\n                      false\n                    );\n                  } else if (document.attachEvent) {\n                    document.attachEvent(\n                      'WeixinJSBridgeReady',\n                      this.onBridgeReady\n                    );\n                    document.attachEvent(\n                      'onWeixinJSBridgeReady',\n                      this.onBridgeReady\n                    );\n                  }\n                } else {\n                  this.onBridgeReady();\n                }\n              })\n              .catch(err => {\n                Dialog.alert({ message: err.data.errmsg });\n                that.$router.replace({\n                  name: 'paymentStatus',\n                  params: {\n                    status: 'failed'\n                  }\n                });\n              });\n          } else {\n            orderH5pay({ orderId: this.orderId })\n              .then(res => {\n                let data = res.data.data;\n                window.location.replace(\n                  data.mwebUrl +\n                  '&redirect_url=' +\n                  encodeURIComponent(\n                    window.location.origin +\n                    '/#/?orderId=' +\n                    this.orderId +\n                    '&tip=yes'\n                  )\n                );\n              })\n              .catch(err => {\n                Dialog.alert({ message: err.data.errmsg });\n              });\n          }\n        } else {\n          //todo : alipay\n        }\n      });\n    },\n    onBridgeReady() {\n      let that = this;\n      let data = getLocalStorage('prepay_data');\n      // eslint-disable-next-line no-undef\n      WeixinJSBridge.invoke(\n        'getBrandWCPayRequest',\n        JSON.parse(data.prepay_data),\n        function(res) {\n          if (res.err_msg == 'get_brand_wcpay_request:ok') {\n            that.$router.replace({\n              name: 'paymentStatus',\n              params: {\n                status: 'success'\n              }\n            });\n          } else if (res.err_msg == 'get_brand_wcpay_request:cancel') {\n            that.$router.replace({\n              name: 'paymentStatus',\n              params: {\n                status: 'cancel'\n              }\n            });\n          } else {\n            that.$router.replace({\n              name: 'paymentStatus',\n              params: {\n                status: 'failed'\n              }\n            });\n          }\n        }\n      );\n    }\n  },\n\n  components: {\n    [Radio.name]: Radio,\n    [RadioGroup.name]: RadioGroup,\n    [Dialog.name]: Dialog\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.payment_group {\n  margin-bottom: 10px;\n}\n\n.time_down {\n  background-color: #fffeec;\n  padding: 10px 15px;\n}\n\n.pay_submit {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n}\n\n.pay_way_group img {\n  vertical-align: middle;\n}\n\n.pay_way_title {\n  padding: 15px;\n  background-color: #fff;\n}\n</style>\n"],"mappings":"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","ignoreList":[]}]}