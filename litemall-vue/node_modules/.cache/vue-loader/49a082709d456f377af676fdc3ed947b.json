{"remainingRequest":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\src\\views\\items\\detail\\index.vue?vue&type=style&index=0&id=6b01719d&lang=scss&scoped=true","dependencies":[{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\src\\views\\items\\detail\\index.vue","mtime":1703663878000},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\css-loader\\index.js","mtime":1737137197319},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1737137197255},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":1737137198226},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1737137197662},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1737137198017},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1737137194839}],"contextDependencies":[],"result":["\n.item_detail {\n  img {\n    max-width: 100%;\n  }\n}\n\n.item_cell_group {\n  margin-bottom: 15px;\n}\n\n.item_price {\n  font-size: 20px;\n  color: $red;\n  margin-right: 10px;\n}\n\n.item_market_price {\n  color: $font-color-gray;\n  text-decoration: line-through;\n  font-size: $font-size-small;\n}\n\n.item-title {\n  line-height: 1.4;\n}\n\n.item_dispatch {\n  font-size: $font-size-small;\n  color: $font-color-gray;\n}\n\n.item_intro {\n  line-height: 18px;\n  margin: 5px 0;\n  font-size: $font-size-small;\n  color: $font-color-gray;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 3;\n}\n\n.item_desc {\n  background-color: #fff;\n  ::v-deep p {\n    padding: 0 10px;\n    margin-block-start: 0 !important;\n    margin-block-end: 0 !important;\n  }\n  ::v-deep img {\n    max-width: 100%;\n    display: block;\n  }\n}\n\n.item_desc_title {\n  @include one-border;\n  padding: 10px 0;\n  text-align: center;\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA4VA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/items/detail","sourcesContent":["<template>\n  <div class=\"item_detail\">\n    <van-swipe :autoplay=\"3000\">\n      <van-swipe-item v-for=\"(image, index) in goods.info.gallery\" :key=\"index\">\n        <img v-lazy=\"image\" width=\"100%\">\n      </van-swipe-item>\n    </van-swipe>\n    <van-cell-group class=\"item_cell_group\" v-if=\"goods\">\n      <van-cell class=\"item_info\">\n        <div>\n          <span class=\"item_price\">{{ goods.info.retailPrice*100 | yuan }}</span>\n          <span class=\"item_market_price\">{{goods.info.counterPrice*100 | yuan}}</span>\n        </div>\n        <div class=\"item-title\">\n          {{ goods.info.name }}\n        </div>\n        <div class=\"item_intro\">{{goods.info.brief}}</div>\n      </van-cell>\n    </van-cell-group>\n\n  <div class=\"item_cell_group\">\n    <van-cell-group>\n      <van-cell\n        title=\"规格\"\n        isLink\n        value=\"请选择\"\n        @click.native=\"skuClick\"\n      />\n      <van-cell title=\"属性\" isLink @click.native=\"propsPopup = true\"/>\n      <van-cell title=\"运费\" value=\"满88免邮费\"/>\n    </van-cell-group>\n    <van-sku\n      v-model=\"showSku\"\n      :sku=\"sku\"\n      :hide-stock=\"true\"\n      :goods=\"skuGoods\"\n      :goodsId=\"goods.info.id\"\n      @buy-clicked=\"buyGoods\"\n      @add-cart=\"addCart\"\n    />\n    <van-popup v-model=\"propsPopup\" position=\"bottom\">\n      <popup-props :propsStr=\"props_str\"></popup-props>\n    </van-popup>\n  </div>\n\n    <div class=\"item_desc\">\n      <div class=\"item_desc_title\">商品详情</div>\n      <div class=\"item_desc_wrap\" v-if=\"goods.info.detail\" v-html=\"goods.info.detail\"></div>\n      <div class=\"item_desc_wrap\" v-else style=\"text-align: center;\">\n        <p>无详情</p>\n      </div>\n    </div>\n\n    <van-goods-action>\n      <van-goods-action-icon @click=\"toCart\" icon=\"cart-o\" :info=\"(cartInfo > 0) ? cartInfo : ''\"/>\n      <van-goods-action-icon @click=\"addCollect\" icon=\"star-o\" :style=\"(goods.userHasCollect !== 0) ? 'color: #f7b444;':''\"/>\n      <van-goods-action-button type=\"warning\" @click=\"skuClick\" text=\"加入购物车\"/>\n      <van-goods-action-button type=\"danger\" @click=\"skuClick\" text=\"立即购买\"/>\n    </van-goods-action>\n\n  </div>\n</template>\n\n<script>\n\nimport { goodsDetail, cartGoodsCount, collectAddOrDelete, cartAdd, cartFastAdd } from '@/api/api';\n\nimport { Sku, Swipe, SwipeItem, GoodsAction, GoodsActionButton, GoodsActionIcon, Popup } from 'vant';\nimport { setLocalStorage } from '@/utils/local-storage';\nimport popupProps from './popup-props';\nimport _ from 'lodash';\n\nexport default {\n  props: {\n    itemId: [String, Number]\n  },\n\n  data() {\n    const isLogin = !!localStorage.getItem('Authorization');\n\n    return {\n      isLogin,\n      goods: {\n        userHasCollect: 0,\n        info: {\n          gallery: []\n        }\n      },\n      sku: {\n        tree: [],\n        list: [],\n        price: '1.00' // 默认价格（单位元）\n      },\n      skuGoods: {\n        // 商品标题\n        title: '',\n        // 默认商品 sku 缩略图\n        picture: ''\n      },\n      cartInfo: 0,\n      selectSku: {\n        selectedNum: 1,\n        selectedSkuComb: {\n          sku_str: 'aa'\n        }\n      },\n      propsPopup: false,\n      showSku: false\n    };\n  },\n\n  computed: {\n    props_str() {\n      let props_arr = [];\n      _.each(this.goods.attribute, json => {\n        props_arr.push([json['attribute'], json['value']]);\n      });\n      return props_arr || [];\n    }\n  },\n\n  created() {\n    this.initData();\n  },\n\n  methods: {\n    skuClick() {\n      this.showSku = true;\n    },\n    initData() {\n      goodsDetail({ id: this.itemId }).then(res => {\n        this.goods = res.data.data;\n        this.skuAdapter();\n      });\n\n      cartGoodsCount().then(res => {\n        this.cartInfo = res.data.data;\n      });\n    },\n    toCart() {\n      this.$router.push({\n        name: 'cart'\n      });\n    },\n    addCollect() {\n      collectAddOrDelete({ valueId: this.itemId, type: 0 }).then(res => {\n        if (this.goods.userHasCollect === 1) {\n          this.goods.userHasCollect = 0;\n        } else {\n          this.goods.userHasCollect = 1;\n          this.$toast({\n            message: '收藏成功',\n            duration: 1500\n          });\n        }\n      });\n    },\n    getProductId(s1, s2) {\n      var productId;\n      var s1_name;\n      var s2_name;\n      _.each(this.goods.specificationList, specification => {\n        _.each(specification.valueList, specValue => {\n          if (specValue.id === s1) {\n            s1_name = specValue.value;\n          } else if (specValue.id === s2) {\n            s2_name = specValue.value;\n          }\n        });\n      });\n\n      _.each(this.goods.productList, v => {\n        let result = _.without(v.specifications, s1_name, s2_name);\n        if (result.length === 0) {\n          productId = v.id;\n        }\n      });\n      return productId;\n    },\n    getProductIdByOne(s1) {\n      var productId;\n      var s1_name;\n      _.each(this.goods.specificationList, specification => {\n        _.each(specification.valueList, specValue => {\n          if (specValue.id === s1) {\n            s1_name = specValue.value;\n            return;\n          }\n        });\n      });\n\n      _.each(this.goods.productList, v => {\n        let result = _.without(v.specifications, s1_name);\n        if (result.length === 0) {\n          productId = v.id;\n        }\n      });\n      return productId;\n    },\n    addCart(data) {\n      let that = this;\n      let params = {\n        goodsId: data.goodsId,\n        number: data.selectedNum,\n        productId: 0\n      };\n      if (_.has(data.selectedSkuComb, 's3')) {\n        this.$toast({\n          message: '目前仅支持两规格',\n          duration: 1500\n        });\n        return;\n      } else if (_.has(data.selectedSkuComb, 's2')) {\n        params.productId = this.getProductId(\n          data.selectedSkuComb.s1,\n          data.selectedSkuComb.s2\n        );\n      } else {\n        params.productId = this.getProductIdByOne(data.selectedSkuComb.s1);\n      }\n      cartAdd(params).then(() => {\n        this.cartInfo = this.cartInfo + data.selectedNum;\n        this.$toast({\n          message: '已添加至购物车',\n          duration: 1500\n        });\n        that.showSku = false;\n      });\n    },\n    buyGoods(data) {\n      let that = this;\n      let params = {\n        goodsId: data.goodsId,\n        number: data.selectedNum,\n        productId: 0\n      };\n      if (_.has(data.selectedSkuComb, 's3')) {\n        this.$toast({\n          message: '目前仅支持两规格',\n          duration: 1500\n        });\n        return;\n      } else if (_.has(data.selectedSkuComb, 's2')) {\n        params.productId = this.getProductId(\n          data.selectedSkuComb.s1,\n          data.selectedSkuComb.s2\n        );\n      } else {\n        params.productId = this.getProductIdByOne(data.selectedSkuComb.s1);\n      }\n      cartFastAdd(params).then(res => {\n        let cartId = res.data.data;\n        setLocalStorage({ CartId: cartId });\n        that.showSku = false;\n        this.$router.push('/order/checkout');\n      });\n    },\n    skuAdapter() {\n      const tree = this.setSkuTree();\n      const list = this.setSkuList();\n      const skuInfo = {\n        price: parseInt(this.goods.info.retailPrice), // 未选择规格时的价格\n        stock_num: 0, // TODO 总库存\n        collection_id: '', // 无规格商品skuId取collection_id，否则取所选sku组合对应的id\n        none_sku: false, // 是否无规格商品\n        hide_stock: true\n      };\n      this.sku = {\n        tree,\n        list,\n        ...skuInfo\n      };\n      this.skuGoods = {\n        title: this.goods.info.name,\n        picture: this.goods.info.picUrl\n      };\n    },\n    setSkuList() {\n      var sku_list = [];\n      _.each(this.goods.productList, v => {\n        var sku_list_obj = {};\n        _.each(v.specifications, (specificationName, index) => {\n          sku_list_obj['s' + (~~index + 1)] = this.findSpecValueIdByName(\n            specificationName\n          );\n        });\n\n        sku_list_obj.price = v.price * 100;\n        sku_list_obj.stock_num = v.number;\n        sku_list.push(sku_list_obj);\n      });\n\n      return sku_list;\n    },\n    findSpecValueIdByName(name) {\n      let id = 0;\n      _.each(this.goods.specificationList, specification => {\n        _.each(specification.valueList, specValue => {\n          if (specValue.value === name) {\n            id = specValue.id;\n            return;\n          }\n        });\n        if (id !== 0) {\n          return;\n        }\n      });\n      return id;\n    },\n    setSkuTree() {\n      let that = this;\n      let specifications = [];\n      _.each(this.goods.specificationList, (v, k) => {\n        let values = [];\n        _.each(v.valueList, vv => {\n          vv.name = vv.value;\n          values.push({\n            id: vv.id,\n            name: vv.value,\n            imUrl: vv.picUrl\n          });\n        });\n\n        specifications.push({\n          k: v.name,\n          v: values,\n          k_s: 's' + (~~k + 1)\n        });\n      });\n\n      return specifications;\n    }\n  },\n\n  components: {\n    [Popup.name]: Popup,\n    [Swipe.name]: Swipe,\n    [SwipeItem.name]: SwipeItem,\n    [Sku.name]: Sku,\n    [GoodsAction.name]: GoodsAction,\n    [GoodsActionButton.name]: GoodsActionButton,\n    [GoodsActionIcon.name]: GoodsActionIcon,\n    [popupProps.name]: popupProps\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.item_detail {\n  img {\n    max-width: 100%;\n  }\n}\n\n.item_cell_group {\n  margin-bottom: 15px;\n}\n\n.item_price {\n  font-size: 20px;\n  color: $red;\n  margin-right: 10px;\n}\n\n.item_market_price {\n  color: $font-color-gray;\n  text-decoration: line-through;\n  font-size: $font-size-small;\n}\n\n.item-title {\n  line-height: 1.4;\n}\n\n.item_dispatch {\n  font-size: $font-size-small;\n  color: $font-color-gray;\n}\n\n.item_intro {\n  line-height: 18px;\n  margin: 5px 0;\n  font-size: $font-size-small;\n  color: $font-color-gray;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 3;\n}\n\n.item_desc {\n  background-color: #fff;\n  ::v-deep p {\n    padding: 0 10px;\n    margin-block-start: 0 !important;\n    margin-block-end: 0 !important;\n  }\n  ::v-deep img {\n    max-width: 100%;\n    display: block;\n  }\n}\n\n.item_desc_title {\n  @include one-border;\n  padding: 10px 0;\n  text-align: center;\n}\n</style>\n"]}]}