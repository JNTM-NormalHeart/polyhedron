{"remainingRequest":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\src\\views\\order\\payment\\index.vue?vue&type=style&index=0&id=1dc36c5e&lang=scss&scoped=true","dependencies":[{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\src\\views\\order\\payment\\index.vue","mtime":1703663878000},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\css-loader\\index.js","mtime":1737137197319},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1737137197255},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":1737137198226},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1737137197662},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1737137198017},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1737137194839}],"contextDependencies":[],"result":["\n.payment_group {\n  margin-bottom: 10px;\n}\n\n.time_down {\n  background-color: #fffeec;\n  padding: 10px 15px;\n}\n\n.pay_submit {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n}\n\n.pay_way_group img {\n  vertical-align: middle;\n}\n\n.pay_way_title {\n  padding: 15px;\n  background-color: #fff;\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA8LA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/order/payment","sourcesContent":["<template>\n  <div class=\"payment\">\n    <div class=\"time_down payment_group\">\n      请在\n      <span class=\"red\">半小时内</span>\n      完成付款，否则系统自动取消订单\n    </div>\n\n    <van-cell-group class=\"payment_group\">\n      <van-cell title=\"订单编号\" :value=\"order.orderInfo.orderSn\"/>\n      <van-cell title=\"实付金额\">\n        <span class=\"red\">{{order.orderInfo.actualPrice *100 | yuan}}</span>\n      </van-cell>\n    </van-cell-group>\n\n    <div class=\"pay_way_group\">\n      <div class=\"pay_way_title\">选择支付方式</div>\n      <van-radio-group v-model=\"payWay\">\n        <van-cell-group>\n          <van-cell>\n            <template slot=\"title\">\n              <img src=\"../../../assets/images/ali_pay.png\" alt=\"支付宝\" width=\"82\" height=\"29\">\n            </template>\n            <van-radio name=\"ali\"/>\n          </van-cell>\n          <van-cell>\n            <template slot=\"title\">\n              <img src=\"../../../assets/images/wx_pay.png\" alt=\"微信支付\" width=\"113\" height=\"23\">\n            </template>            \n            <van-radio name=\"wx\"/>\n          </van-cell>\n        </van-cell-group>\n      </van-radio-group>\n    </div>\n\n    <van-button class=\"pay_submit\" @click=\"pay\" type=\"primary\" bottomAction>去支付</van-button>\n  </div>\n</template>\n\n<script>\nimport { Radio, RadioGroup, Dialog } from 'vant';\nimport { orderDetail, orderPrepay, orderH5pay } from '@/api/api';\nimport _ from 'lodash';\nimport { getLocalStorage, setLocalStorage } from '@/utils/local-storage';\n\nexport default {\n  name: 'payment',\n\n  data() {\n    return {\n      payWay: 'wx',\n      order: {\n        orderInfo: {},\n        orderGoods: []\n      },\n      orderId: 0\n    };\n  },\n  created() {\n    if (_.has(this.$route.params, 'orderId')) {\n      this.orderId = this.$route.params.orderId;\n      this.getOrder(this.orderId);\n    }\n  },\n  methods: {\n    getOrder(orderId) {\n      orderDetail({orderId: orderId}).then(res => {\n        this.order = res.data.data;\n      });\n    },\n    pay() {\n      \n      Dialog.alert({\n        message: '你选择了' + (this.payWay === 'wx' ? '微信支付' : '支付宝支付')\n      }).then(() => {\n        if (this.payWay === 'wx') {\n          let ua = navigator.userAgent.toLowerCase();\n          let isWeixin = ua.indexOf('micromessenger') != -1;\n          if (isWeixin) {\n            orderPrepay({ orderId: this.orderId })\n              .then(res => {\n                let data = res.data.data;\n                let prepay_data = JSON.stringify({\n                  appId: data.appId,\n                  timeStamp: data.timeStamp,\n                  nonceStr: data.nonceStr,\n                  package: data.packageValue,\n                  signType: 'MD5',\n                  paySign: data.paySign\n                });\n                setLocalStorage({ prepay_data: prepay_data });\n\n                if (typeof WeixinJSBridge == 'undefined') {\n                  if (document.addEventListener) {\n                    document.addEventListener(\n                      'WeixinJSBridgeReady',\n                      this.onBridgeReady,\n                      false\n                    );\n                  } else if (document.attachEvent) {\n                    document.attachEvent(\n                      'WeixinJSBridgeReady',\n                      this.onBridgeReady\n                    );\n                    document.attachEvent(\n                      'onWeixinJSBridgeReady',\n                      this.onBridgeReady\n                    );\n                  }\n                } else {\n                  this.onBridgeReady();\n                }\n              })\n              .catch(err => {\n                Dialog.alert({ message: err.data.errmsg });\n                that.$router.replace({\n                  name: 'paymentStatus',\n                  params: {\n                    status: 'failed'\n                  }\n                });\n              });\n          } else {\n            orderH5pay({ orderId: this.orderId })\n              .then(res => {\n                let data = res.data.data;\n                window.location.replace(\n                  data.mwebUrl +\n                  '&redirect_url=' +\n                  encodeURIComponent(\n                    window.location.origin +\n                    '/#/?orderId=' +\n                    this.orderId +\n                    '&tip=yes'\n                  )\n                );\n              })\n              .catch(err => {\n                Dialog.alert({ message: err.data.errmsg });\n              });\n          }\n        } else {\n          //todo : alipay\n        }\n      });\n    },\n    onBridgeReady() {\n      let that = this;\n      let data = getLocalStorage('prepay_data');\n      // eslint-disable-next-line no-undef\n      WeixinJSBridge.invoke(\n        'getBrandWCPayRequest',\n        JSON.parse(data.prepay_data),\n        function(res) {\n          if (res.err_msg == 'get_brand_wcpay_request:ok') {\n            that.$router.replace({\n              name: 'paymentStatus',\n              params: {\n                status: 'success'\n              }\n            });\n          } else if (res.err_msg == 'get_brand_wcpay_request:cancel') {\n            that.$router.replace({\n              name: 'paymentStatus',\n              params: {\n                status: 'cancel'\n              }\n            });\n          } else {\n            that.$router.replace({\n              name: 'paymentStatus',\n              params: {\n                status: 'failed'\n              }\n            });\n          }\n        }\n      );\n    }\n  },\n\n  components: {\n    [Radio.name]: Radio,\n    [RadioGroup.name]: RadioGroup,\n    [Dialog.name]: Dialog\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.payment_group {\n  margin-bottom: 10px;\n}\n\n.time_down {\n  background-color: #fffeec;\n  padding: 10px 15px;\n}\n\n.pay_submit {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n}\n\n.pay_way_group img {\n  vertical-align: middle;\n}\n\n.pay_way_title {\n  padding: 15px;\n  background-color: #fff;\n}\n</style>\n"]}]}