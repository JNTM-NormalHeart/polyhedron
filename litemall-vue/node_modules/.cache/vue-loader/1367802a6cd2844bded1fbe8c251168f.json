{"remainingRequest":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\src\\views\\order\\checkout.vue?vue&type=style&index=0&id=26a06ffe&lang=scss&scoped=true","dependencies":[{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\src\\views\\order\\checkout.vue","mtime":1703663878000},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\css-loader\\index.js","mtime":1737137197319},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1737137197255},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":1737137198226},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1737137197662},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1737137198017},{"path":"C:\\Users\\Wang\\Desktop\\polyhedron\\litemall-master\\litemall-master\\litemall-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1737137194839}],"contextDependencies":[],"result":["\n.order-coupon {\n  margin-top: 10px;\n}\n",{"version":3,"sources":["checkout.vue"],"names":[],"mappings":";AAiPA;AACA;AACA","file":"checkout.vue","sourceRoot":"src/views/order","sourcesContent":["<template>\n<div class=\"order\">\n  <van-cell-group>\n      <van-cell v-if=\"checkedAddress\" isLink @click=\"goAddressList()\" title=\"收货地址\">\n      <div slot=\"label\">\n        <div>\n         <span>{{ checkedAddress.name }} </span>\n         <span>{{ checkedAddress.tel }} </span>\n      </div>\n      <div>\n        {{ checkedAddress.addressDetail }}\n      </div>\n      </div>\n    </van-cell>\n  </van-cell-group>\n\n  <van-cell-group>\n    <van-cell class=\"order-coupon\" title=\"优惠券\" is-link :value=\"getCouponValue()\" @click=\"getCoupons\" />\n  </van-cell-group>\n\n<!-- 优惠券列表 -->\n<van-popup v-model=\"showList\" position=\"bottom\">\n  <van-coupon-list\n    :coupons=\"coupons\"\n    :chosen-coupon=\"chosenCoupon\"\n    :disabled-coupons=\"disabledCoupons\"\n    @change=\"onChange\"\n    @exchange=\"onExchange\"\n  />\n</van-popup>\n\n    <van-card\n      v-for=\"item in checkedGoodsList\"\n      :key=\"item.id\"\n      :title=\"item.goodsName\"\n      :num=\"item.number\"\n      :price=\"item.price +'.00'\"\n      :thumb=\"item.picUrl\"\n    >\n      <div slot=\"desc\">\n        <div class=\"van-card__desc\">\n          <van-tag plain style=\"margin-right:6px;\" v-for=\"(spec, index) in item.specifications\" :key=\"index\">\n            {{spec}}\n          </van-tag>\n        </div>\n      </div>\n    </van-card>\n\n    <van-cell-group>\n      <van-cell title=\"商品金额\">\n        <span class=\"red\">{{goodsTotalPrice * 100 | yuan}}</span>\n      </van-cell>\n      <van-cell title=\"邮费\">\n        <span class=\"red\">{{ freightPrice * 100| yuan}}</span>\n      </van-cell>\n      <van-cell title=\"优惠券\">\n        <span class=\"red\">-{{ couponPrice * 100| yuan}}</span>\n      </van-cell>\n      <van-field v-model=\"message\" placeholder=\"请输入备注\" label=\"订单备注\">\n      <template slot=\"icon\">{{message.length}}/50</template>\n      </van-field>      \n    </van-cell-group>\n\n    <van-submit-bar\n      :price=\"actualPrice*100\"\n      label=\"总计：\"\n      buttonText=\"提交订单\"\n      :disabled=\"isDisabled\"\n      @submit=\"onSubmit\"\n    />\n</div>\n</template>\n\n<script>\nimport { Card, Tag, ard, Field, SubmitBar, Toast  } from 'vant';\nimport { CouponCell, CouponList, Popup } from 'vant';\nimport { cartCheckout, orderSubmit, couponSelectList} from '@/api/api';\nimport { getLocalStorage, setLocalStorage } from '@/utils/local-storage';\nimport dayjs from 'dayjs';\n\nexport default {\n  data() {\n    return {\n      checkedGoodsList: [],\n      checkedAddress: {},\n      availableCouponLength: 0, // 可用的优惠券数量\n      goodsTotalPrice: 0, //商品总价\n      freightPrice: 0, //快递费\n      couponPrice: 0, //优惠券的价格\n      grouponPrice: 0, //团购优惠价格\n      orderTotalPrice: 0, //订单总价\n      actualPrice: 0, //实际需要支付的总价\n      message: '',\n\n      isDisabled: false,\n      showList: false,\n      chosenCoupon: -1,\n      coupons: [],\n      disabledCoupons: [] \n    };\n  },\n  created() {\n    this.init();\n  },\n\n  methods: {\n    onSubmit() {     \n      const {AddressId, CartId, CouponId, UserCouponId} = getLocalStorage('AddressId', 'CartId', 'CouponId', 'UserCouponId');\n\n      if (AddressId === null || AddressId === \"0\") {\n        Toast.fail('请设置收货地址');\n        return;\n      }\n\n\n      this.isDisabled = true;\n\n      orderSubmit({\n        addressId: AddressId,\n        cartId: CartId,\n        couponId: CouponId,\n        userCouponId: UserCouponId,\n        grouponLinkId: 0,\n        grouponRulesId: 0,\n        message: this.message\n      }).then(res => {\n        \n        // 下单成功，重置下单参数。\n        setLocalStorage({AddressId: 0, CartId: 0, CouponId: 0});\n\n        let orderId = res.data.data.orderId;\n        this.$router.push({\n          name: 'payment',\n          params: { orderId: orderId }\n        });\n      }).catch(error => {\n        this.isDisabled = false;\n        this.$toast(\"下单失败\");\n      })\n\n    },\n    goAddressList() {\n      this.$router.push({\n        path: '/user/address'\n      });\n    },\n    getCouponValue() {\n      if(this.couponPrice !== 0 ){\n        return \"-¥\" + this.couponPrice + \".00元\"\n      }\n      if(this.availableCouponLength !== 0){\n        return this.availableCouponLength + \"张可用\"\n      }\n      return '没有可用优惠券'\n    },\n    getCoupons() {\n      const {AddressId, CartId, CouponId} = getLocalStorage('AddressId', 'CartId', 'CouponId');\n      couponSelectList({cartId: CartId, grouponRulesId: 0}).then(res => {\n        var cList = res.data.data.list;\n        this.coupons = []\n        this.disabledCoupons = [];\n        for(var i = 0; i < cList.length; i++){\n          var c = cList[i]\n\n          var coupon = {\n            id: c.id,\n            cid: c.cid,\n            name: c.name,\n            condition: '满' + c.min + '元可用',\n            value: c.discount * 100,\n            description: c.desc,\n            startAt: new Date(c.startTime).getTime()/1000,\n            endAt: new Date(c.endTime).getTime()/1000,\n            valueDesc: c.discount,\n            unitDesc: '元'            \n          }\n          if (c.available) {\n            this.coupons.push(coupon);\n          } else {\n            this.disabledCoupons.push(coupon);\n          }\n        }\n        \n        this.showList = true\n      })\n    },\n    init() {\n      const {AddressId, CartId, CouponId, UserCouponId} = getLocalStorage('AddressId', 'CartId', 'CouponId', 'UserCouponId');\n\n      cartCheckout({cartId: CartId, addressId: AddressId, couponId: CouponId, userCouponId: UserCouponId, grouponRulesId: 0}).then(res => {\n          var data = res.data.data\n\n          this.checkedGoodsList = data.checkedGoodsList;\n          this.checkedAddress= data.checkedAddress;\n          this.availableCouponLength= data.availableCouponLength;\n          this.actualPrice= data.actualPrice;\n          this.couponPrice= data.couponPrice;\n          this.grouponPrice= data.grouponPrice;\n          this.freightPrice= data.freightPrice;\n          this.goodsTotalPrice= data.goodsTotalPrice;\n          this.orderTotalPrice= data.orderTotalPrice;\n\n          setLocalStorage({AddressId: data.addressId, CartId: data.cartId, CouponId: data.couponId, UserCouponId: data.userCouponId});\n      });\n\n    },\n    onChange(index) {\n      this.showList = false;\n      this.chosenCoupon = index;\n      \n      if(index === -1 ){\n        setLocalStorage({CouponId: -1, UserCouponId: -1});\n      }\n      else{\n        const couponId = this.coupons[index].cid;\n        const userCouponId = this.coupons[index].id;\n        setLocalStorage({CouponId: couponId, UserCouponId: userCouponId});\n      }\n\n      this.init()\n    },\n    onExchange() {\n      this.$toast(\"兑换暂不支持\");\n    }    \n  },\n\n  components: {\n    [Toast.name]: Toast ,\n    [SubmitBar.name]: SubmitBar,\n    [Card.name]: Card,\n    [Field.name]: Field,\n    [Tag.name]: Tag,\n    [CouponCell.name]: CouponCell,\n    [CouponList.name]: CouponList,\n    [Popup.name]: Popup\n  }\n};\n</script>\n\n\n<style lang=\"scss\" scoped>\n.order-coupon {\n  margin-top: 10px;\n}\n</style>"]}]}